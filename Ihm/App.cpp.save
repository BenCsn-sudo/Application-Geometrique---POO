#include "App.h"

App::App()
    : window(sf::VideoMode(800, 600), "Figures")
{
    if (!font.loadFromFile("Ihm/arial.ttf")) {
        throw std::runtime_error("Impossible de charger Ihm/arial.ttf");
    }

    figures.push_back(new Cercle({200.f, 200.f}, 60.f));
    figures.push_back(new Triangle({400.f, 100.f}, {500.f, 300.f}, {300.f, 300.f}));
    figures.push_back(new Rectangle({100.f, 400.f}, {200.f, 420.f}, 200.f, 80.f));
    figures.push_back(new Carre({500.f, 350.f}, {600.f, 360.f}, 100.f));
}

App::~App() {
    for (auto f : figures)
        delete f;
}

void App::run() {

    while (window.isOpen()) {

        sf::Event event;
        while (window.pollEvent(event)) {
            if (event.type == sf::Event::Closed)
                window.close();
        }

        window.clear(sf::Color::White);

        // Afficher les figures
        for (auto f : figures)
            f->draw(window);

        // Affichage texte en haut à gauche
        float y = 10.f;
        for (auto f : figures) {

            sf::Text info;
            info.setFont(font);
            info.setCharacterSize(17);
            info.setFillColor(sf::Color::Black);

            // Identifier la classe
            std::string type;
            if (dynamic_cast<Cercle*>(f))      type = "Cercle   ";
            else if (dynamic_cast<Triangle*>(f)) type = "Triangle ";
            else if (dynamic_cast<Rectangle*>(f)) type = "Rectangle";
            else if (dynamic_cast<Carre*>(f))     type = "Carre    ";

            // Aire et périmètre
            float A = f->area();
            float P = f->perimeter();

            // Formatage court
            auto toShort = [](float v) {
                std::string s = std::to_string(v);
                return s.substr(0, 6); // 6 caractères max
            };

            info.setString(
                type + " :  A = " + toShort(A) +
                "  |  P = " + toShort(P)
            );

            info.setPosition(10.f, y);
            y += 25.f;

            window.draw(info);
        }

        window.display();
    }
}
